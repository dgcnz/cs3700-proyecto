# -*- coding: utf-8 -*-
"""Proyecto.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1opm0m9-5o0OMUzqYEfkkGhuI_a-WkTMy
"""

import urllib.request, json

def getData(url):
  response = urllib.request.urlopen(url)
  data = json.loads(response.read())
  return data["result"]

urluser = "https://codeforces.com/api/user.ratedList"
urlprob = "https://codeforces.com/api/problemset.problems"
urlrating = " https://codeforces.com/api/contest.ratingChanges"

"""# User"""

dataUser = getData(urluser)
len(dataUser)

import csv

with open('user.csv', mode='w') as user_file:
    user_writer = csv.writer(user_file, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    for user in dataUser:
      user_writer.writerow([user["handle"], user.get("country", ""), user.get("city", ""), user["rating"], 
                            user["maxRating"], user["lastOnlineTimeSeconds"],])

dataUser[0].keys()

dataUser[0]

"""# Problem"""

dataProblem = getData(urlprob)
len(dataProblem)

dataProblem.keys()

len(dataProblem["problemStatistics"]) ,len(dataProblem["problems"])

'|'.join(dataProblem["problems"][0]["tags"])

with open('problem.csv', mode='w') as problem_file:
    problem_writer = csv.writer(problem_file, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    for problem, problemstat in zip(dataProblem["problems"], dataProblem["problemStatistics"]):
      tags = '|'.join(problem["tags"])
      problem_writer.writerow([problem["contestId"], problem.get("rating", ""), problem["type"], tags, 
                            problemstat["solvedCount"]])

print(dataProblem["problemStatistics"][0].keys())
dataProblem["problemStatistics"][0]

print(dataProblem["problems"][0].keys())
dataProblem["problems"][0]

"""# Rating"""

dataRating = getData("https://codeforces.com/api/contest.list")
len(dataRating)